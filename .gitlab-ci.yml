stages:
- develop

deploy:
  stage: develop
   tags:
      - testdeploy
  script:
  - if [ $CI_COMMIT_REF_NAME = 'develop' ]; then
  - rm -Rf ~/testdeploy/
  - mkdir ~/testdeploy/
  - cd ~/testdeploy/
  - rm -Rf repository/
  - rm -Rf site/
  - mkdir repository
  - mkdir site
  - git clone --mirror git@gitlab.com:kbc-itw/smile-cycle ./repository
  - cd ./repository
  - git --work-tree=../site/ checkout -f develop
  - cd ../site/
  - rsync -rlOzv --delete --checksum ./ /home/kbcadminstudent/
  - cd /home/kbcadminstudent/
  - else
  - echo 'エラーです'
  - fi
  only:
    refs:
      - merge_requests
  variables:
      - $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "develop"

